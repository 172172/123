<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carlsberg Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            margin: 0;
            background-color: #1a1f24;
            color: #ffffff;
            font-family: 'Inter', sans-serif;
        }
        .container {
            max-width: 1440px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background-color: #2b3239;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 40px;
            align-items: center;
        }

        .header-title {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .header-title h1 {
            font-size: 24px;
            font-weight: 700;
            margin: 0;
        }

        .header-info {
            display: flex;
            gap: 20px;
            align-items: center;
            color: #b0b3b8;
        }

        .header-info-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-info-item span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .header-info-item.running span {
            background-color: #4caf50;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-info img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #4caf50;
        }
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: #2b3239;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        .status-bar .oee {
            font-size: 18px;
            font-weight: 600;
            color: #67c23a;
        }
        .status-bar .live-indicator {
            color: #f56c6c;
            font-weight: 600;
        }
        .batch-info {
            background-color: #1c252b;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .batch-info h2 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
        }
        .batch-details {
            display: grid;
            grid-template-columns: 1fr 1px 1fr 1px 300px;
            gap: 20px;
            align-items: start;
        }
        .batch-details > div:nth-child(2),
        .batch-details > div:nth-child(4) {
            background-color: #3a3f44;
            width: 1px;
        }
        .progress-container {
            background-color: #3a3f44;
            height: 10px;
            border-radius: 5px;
            margin: 10px 0;
            position: relative;
        }
        .progress-bar {
            background-color: #4caf50;
            height: 10px;
            border-radius: 5px;
            width: 10%;
        }
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .status-indicator span {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #4caf50;
        }
        .chart-container {
            width: 200px;
            height: 200px;
            margin: 0 auto;
        }
        .production-overview {
            position: relative;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .card {
            background-color: #2b3239;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .card h2 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        .card p {
            font-size: 14px;
            color: #b0b3b8;
        }
        .material-status {
            background-color: #1c252b;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .material-status h2 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .material-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .material-card {
            background-color: #2b3239;
            border-radius: 8px;
            padding: 15px;
        }

        .material-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .material-header h3 {
            font-size: 16px;
            font-weight: 600;
        }

        .status-tag {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        .status-tag.good {
            background-color: #4caf50;
            color: white;
        }

        .status-tag.warning {
            background-color: #FFA500;
            color: white;
        }

        .material-details p {
            margin: 8px 0;
            font-size: 14px;
            color: #b0b3b8;
        }

        .material-progress {
            background-color: #3a3f44;
            height: 8px;
            border-radius: 4px;
            margin-top: 15px;
        }

        .material-progress .progress-bar {
            background-color: #4caf50;
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .shift-handover {
            background-color: #1c252b;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .handover-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 10px;
        }

        .handover-header h2 {
            font-size: 20px;
            font-weight: 600;
        }

        .handover-content {
            display: none;
            padding: 15px;
            background-color: #2b3239;
            border-radius: 8px;
            margin-top: 10px;
        }

        .handover-content.active {
            display: block;
        }

        .handover-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .summary-item {
            padding: 10px;
            background-color: #1c252b;
            border-radius: 4px;
        }

        .handover-notes {
            background-color: #1c252b;
            padding: 15px;
            border-radius: 4px;
        }

        .toggle-icon {
            color: #b0b3b8;
            font-size: 24px;
        }

        .warning-message {
            background-color: #ff9800;
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            display: none;
            animation: fadeIn 0.5s;
        }

        .error-message {
            background-color: #f44336;
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            display: none;
            animation: fadeIn 0.5s;
        }

        .card.warning {
            border: 2px solid #ff9800;
            box-shadow: 0 0 10px rgba(255, 152, 0, 0.3);
        }

        .card.error {
            border: 2px solid #f44336;
            box-shadow: 0 0 10px rgba(244, 67, 54, 0.3);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Add to existing styles */
        .arrow-indicator {
            position: absolute;
            left: calc(15% + 50px);
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 30px;
            opacity: 0;
            visibility: hidden;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .arrow-indicator::after {
            content: '→';
            font-size: 36px; /* Increased size */
            font-weight: bold; /* Make it bolder */
            color: currentColor;
            text-shadow: 0 0 10px currentColor; /* Add glow effect */
        }

        .arrow-indicator.warning {
            visibility: visible;
            opacity: 1;
            color: #ff9800;
            animation: arrowPulse 2s infinite;
        }

        .arrow-indicator.error {
            visibility: visible;
            opacity: 1;
            color: #f44336;
            animation: arrowPulse 1s infinite;
        }

        @keyframes arrowPulse {
            0% { opacity: 0.6; transform: translateY(-50%) scale(1); }
            50% { opacity: 1; transform: translateY(-50%) scale(1.3); }
            100% { opacity: 0.6; transform: translateY(-50%) scale(1); }
        }

        .warning-indicator {
            position: absolute;
            left: calc(15% + 36px);
            top: -20px; /* Position above machines */
            width: 60px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            opacity: 0;
            visibility: hidden;
            z-index: 1000;
        }

        .warning-indicator .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: currentColor;
        }

        .warning-indicator .exclamation {
            font-size: 30px;
            font-weight: bold;
        }

        .warning-indicator.warning {
            visibility: visible;
            opacity: 1;
            color: #ff9800;
        }

        .warning-indicator.error {
            visibility: visible;
            opacity: 1;
            color: #f44336;
        }

        .warning-indicator.warning .dot {
            animation: dotPulse 2s infinite;
        }

        .warning-indicator.error .dot {
            animation: dotPulse 1s infinite;
        }

        @keyframes dotPulse {
            0% { transform: scale(1); opacity: 0.6; }
            50% { transform: scale(1.5); opacity: 1; }
            100% { transform: scale(1); opacity: 0.6; }
        }

        .copilot-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #4caf50;
            cursor: move;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .chat-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 500px;  /* Increased from 300px */
            background-color: #2b3239;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            display: none;
            flex-direction: column;
            z-index: 999;
        }

        .chat-header {
            padding: 15px;
            background-color: #1c252b;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            max-height: calc(100% - 120px);  /* Adjusted for new container height */
        }

        .chat-input {
            padding: 15px;
            border-top: 1px solid #3a3f44;
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #3a3f44;
            background-color: #1c252b;
            color: white;
        }

        .chat-input button {
            padding: 8px 15px;
            border-radius: 4px;
            background-color: #4caf50;
            color: white;
            border: none;
            cursor: pointer;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 998;
        }

        .overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .card.focus {
            position: relative;
            z-index: 999;
            transform: scale(1.05);
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
        }

        .card.warning.focus {
            box-shadow: 0 0 20px rgba(255, 152, 0, 0.3);
        }

        .card.error.focus {
            box-shadow: 0 0 20px rgba(244, 67, 54, 0.3);
        }

        #alertContainer {
            position: absolute;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .warning-message, .error-message {
            background-color: #2b3239;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin: 10px 0;
            display: none;
            animation: fadeIn 0.5s;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .warning-message.focus {
            border-left: 4px solid #ff9800;
            box-shadow: 0 0 20px rgba(255, 152, 0, 0.3);
        }

        .error-message.focus {
            border-left: 4px solid #f44336;
            box-shadow: 0 0 20px rgba(244, 67, 54, 0.3);
        }

        .system-message {
            background-color: #1c252b;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #4caf50;
            font-size: 14px;
            line-height: 1.5;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .card {
    position: relative; /* Behövs för att positionera ikonen relativt till kortet */
    background-color: #2b3239;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.status-icon-container {
    position: absolute;
    top: 1px;
    right: 1px;
    background-color: #2b3239; /* Matcha kortets bakgrundsfärg */
    border-radius: 50%;
    padding: 5px;
}

.status-icon {
    color: #4caf50;
    font-size: 28px;
}

.status-icon {
    color: #4caf50; /* Green for running */
}

.status-icon.warning {
    color: #ff9800; /* Yellow for warning */
}

.status-icon.error {
    color: #f44336; /* Red for error */
}

.machine-readiness {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 10px;
    padding: 5px 10px;
    background: rgba(76, 175, 80, 0.1);
    border-radius: 4px;
    font-size: 14px;
}

.machine-readiness i {
    color: #4caf50;
}

.machine-readiness.not-ready i {
    color: #f44336;
}

.machine-readiness.ready i {
    color: #4caf50;
}

.machine-readiness-status {
    margin-top: 20px;
}

.material-card {
    cursor: pointer;
    position: relative;
}

.order-notification {
    position: absolute;
    top: 10px;
    right: 10px;
    background-color: #4caf50;
    color: white;
    padding: 5px 10px;
    border-radius: 4px;
    font-size: 12px;
    display: none;
}

.material-card.ordered .order-notification {
    display: block;
}

/* Theme toggle switch */
.theme-toggle {
    position: absolute;
    top: 20px;
    right: 20px;
    z-index: 1001;
}

.switch {
    position: relative;
    display: inline-block;
    width: 80px;
    height: 34px;
}

.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #4caf50;
    transition: .4s;
}

.slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
}

input:checked + .slider {
    background-color: #2b3239;
}

input:checked + .slider:before {
    transform: translateX(46px);
}

.slider.round {
    border-radius: 34px;
}

.slider.round:before {
    border-radius: 50%;
}

.toggle-labels {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 10px;
    box-sizing: border-box;
    pointer-events: none;
    font-size: 12px;
}

.toggle-labels .light {
    color: #333;
}

.toggle-labels .dark {
    color: #fff;
}

/* Light theme styles */
body.light-theme {
    background-color: #f4f7fa;
    color: #333333;
}

.light-theme .header,
.light-theme .card,
.light-theme .status-bar,
.light-theme .chat-container,
.light-theme .chat-header {
    background-color: #ffffff;
    color: #333333;
}

.light-theme .batch-info,
.light-theme .material-status,
.light-theme .shift-handover {
    background-color: #ffffff;
    color: #333333;
}

.light-theme .material-card {
    background-color: #f4f7fa;
    color: #333333;
}

.light-theme .progress-container,
.light-theme .material-progress {
    background-color: #e0e0e0;
}

.light-theme .header-info,
.light-theme p {
    color: #333333;
}

.light-theme .summary-item,
.light-theme .handover-notes,
.light-theme .chat-input input {
    background-color: #f4f7fa;
    color: #333333;
}

.light-theme .system-message {
    background-color: #e0e0e0;
    color: #333333;
    border-left: 4px solid #4caf50;
}

.light-theme .warning-message.focus {
    background-color: #ffffff;
    border-left: 4px solid #ff9800;
}

.light-theme .error-message.focus {
    background-color: #ffffff;
    border-left: 4px solid #f44336;
}

/* Add this to your <style> section */
.main-navigation {
    display: flex;
    gap: 20px;
    padding: 10px 0;
    margin-bottom: 20px;
    border-radius: 8px;
    overflow-x: auto;
}

.nav-item {
    padding: 10px 20px;
    background-color: #2b3239;
    border-radius: 8px;
    cursor: pointer;
    white-space: nowrap;
    font-weight: 600;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.nav-item:hover {
    background-color: #3a3f44;
}

.nav-item.active {
    background-color: #4caf50;
    color: white;
}

.page {
    display: none;
}

.page.active {
    display: block;
}

.back-button {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 20px;
    border: none;
    background-color: #2b3239;
    color: white;
    border-radius: 8px;
    cursor: pointer;
    margin-bottom: 20px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.back-button:hover {
    background-color: #3a3f44;
}

.handover-page {
    background-color: #1c252b;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 30px;
}

.handover-page .handover-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
}

.handover-page .handover-header h2 {
    font-size: 20px;
    font-weight: 600;
}

.handover-page .handover-content {
    display: block;
    padding: 15px;
    background-color: #2b3239;
    border-radius: 8px;
    margin-top: 10px;
}

.light-theme .handover-page {
    background-color: #ffffff;
    color: #333333;
}

.light-theme .handover-page .handover-content {
    background-color: #f4f7fa;
}

/* Additional styles for light theme */
.light-theme .nav-item {
    background-color: #ffffff;
    color: #333333;
}

.light-theme .nav-item:hover {
    background-color: #f4f7fa;
}

.light-theme .nav-item.active {
    background-color: #4caf50;
    color: white;
}

.light-theme .back-button {
    background-color: #ffffff;
    color: #333333;
}

.light-theme .back-button:hover {
    background-color: #f4f7fa;
}

.light-theme .handover-page {
    background-color: #ffffff;
    color: #333333;
}

/* Add to your style section */
.user-actions {
    display: flex;
    align-items: center;
    gap: 20px;
}

.handover-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background-color: #1c252b;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 600;
}

.handover-btn:hover {
    background-color: #3a3f44;
}

.light-theme .handover-btn {
    background-color: #f4f7fa;
    color: #333333;
}

.light-theme .handover-btn:hover {
    background-color: #e0e0e0;
}
    </style>
    <!-- Add Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Add this right after the opening <body> tag, before the container div -->
    <div class="theme-toggle">
        <label class="switch">
            <input type="checkbox" id="themeToggle" checked>
            <span class="slider round"></span>
            <div class="toggle-labels">
                <span class="light">Light</span>
                <span class="dark">Dark</span>
            </div>
        </label>
    </div>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="header-title">
                    <h1>Carlsberg Dashboard</h1>
                    <p>Production Line Overview</p>
                </div>
                <div class="header-info">
                    <div class="header-info-item">
                        <i class="fas fa-industry"></i>
                        Plant: Falkenberg
                    </div>
                    <div class="header-info-item">
                        <i class="fas fa-cog"></i>
                        Line: 65
                    </div>
                    <div class="header-info-item running">
                        <span></span>
                        Status: Running
                    </div>
                    <div class="header-info-item">
                        <i class="fas fa-clock"></i>
                        Shift: Morning
                    </div>
                </div>
                <div class="user-actions">
                    <div class="handover-btn" onclick="navigateTo('handover')">
                        <i class="fas fa-exchange-alt"></i>
                        Shift Handover
                    </div>
                    <div class="user-info">
                        <div>
                            <p style="margin: 0; font-weight: 600;">KEVIN</p>
                            <p style="margin: 0; font-size: 12px; color: #b0b3b8;">Line Operator</p>
                        </div>
                        <img src="https://via.placeholder.com/40" alt="Profile Picture">
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <p>Currently Producing: Pripps Blå CAN 4x6x0.5 3.5%</p>
            <p class="oee">Current Run OEE: 67.43%</p>
            <p class="live-indicator">LIVE</p>
        </div>

        <!-- Modify your content by wrapping the existing dashboard content in a page div -->
        <div id="mainPage" class="page active">
            <!-- Alert Container -->
            <div id="alertContainer"></div>

            <!-- Production Overview and everything else remains as is -->
            <div class="production-overview">
                <div class="arrow-indicator" id="machineArrow"></div>
                <div class="warning-indicator" id="machineWarning">
                    <div class="dot"></div>
                    <span class="exclamation">!</span>
                    <div class="dot"></div>
                </div>
                <div class="card" id="depalletizer">
                    <div class="status-icon-container">
                        <i class="fas fa-check-circle status-icon"></i>
                    </div>
                    <h2>Depalletizer</h2>
                    <p>Running</p>
                    <p>2/480 Pallets separated</p>
                </div>            
                <div class="card" id="filler">
                    <div class="status-icon-container">
                        <i class="fas fa-check-circle status-icon"></i>
                    </div>
                    <h2>Filler</h2>
                    <p>Running</p>
                    <p>862 Units filled</p>
                </div>
                <div class="card">
                    <div class="status-icon-container">
                        <i class="fas fa-check-circle status-icon"></i>
                    </div>
                    <h2>Tray Packer</h2>
                    <p>Running</p>
                    <p>1,245 Units packed</p>
                </div>
                <div class="card" id="shrinkpacker">
                    <div class="status-icon-container">
                        <i class="fas fa-check-circle status-icon"></i>
                    </div>
                    <h2>ShrinkPacker</h2>
                    <p>Running</p>
                    <p>1,786 Units ShrinkWrapped</p>
                </div>
                <div class="card" id="palletizer">
                    <div class="status-icon-container">
                        <i class="fas fa-check-circle status-icon"></i>
                    </div>
                    <h2>Palletizer</h2>
                    <p>Running</p>
                    <p>18/128 Pallets completed</p>
                </div>
            </div>
            
            <!-- Material Status -->
            <div class="material-status">
                <h2>Material Status</h2>
                <div class="material-cards">
                    <div class="material-card">
                        <div class="material-header">
                            <h3>Tray Material</h3>
                            <span class="status-tag good">In Stock</span>
                        </div>
                        <div class="material-details">
                            <p>Current Stock: 12,500 units</p>
                            <p>Consumption Rate: 2,400 units/hour</p>
                            <p>Remaining Time: 5.2 hours</p>
                            <div class="material-progress">
                                <div class="progress-bar" style="width: 65%;"></div>
                            </div>
                        </div>
                    </div>

                    <div class="material-card" id="shrinkCard">
                        <div class="material-header">
                            <h3>Shrink</h3>
                            <span class="status-tag warning">Low Stock</span>
                        </div>
                        <div class="material-details">
                            <p>Current Stock: 4,200 units</p>
                            <p>Consumption Rate: 2,400 units/hour</p>
                            <p>Remaining Time: 1.75 hours</p>
                            <div class="material-progress">
                                <div class="progress-bar" style="width: 25%; background-color: #FFA500;"></div>
                            </div>
                        </div>
                        <div class="order-notification">Order Sent</div>
                    </div>
                </div>
            </div>

            <!-- Current Batch -->
            <div class="batch-info">
                <h2>Current Batch</h2>
                <div class="batch-details">
                    <div>
                        <p>Order: 110351471</p>
                        <p>Pripps Blå CAN 4x6x0.5 3.5%</p>
                        <p>Scheduled Time: 248 minutes</p>
                        <p>Best Practice: 239 minutes</p>
                        <p>Unit Amount: 270,300</p>
                    </div>
                    <div></div> <!-- Divider -->
                    <div>
                        <div class="progress-container">
                            <div class="progress-bar" style="width: 10%;"></div>
                        </div>
                        <p>2,380 of 526,440 Units Produced</p>
                        <div class="status-indicator">
                            <span class="on-schedule"></span>
                            <p>On Schedule</p>
                        </div>
                    </div>
                    <div></div> <!-- Divider -->
                    <div class="chart-container">
                        <canvas id="currentStopsChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Upcoming Batch -->
            <div class="batch-info">
                <h2>Upcoming Batch</h2>
                <div class="batch-details">
                    <div>
                        <p>Order: 110351472</p>
                        <p>Falcon Export CAN Coolpack 5.2%</p>
                        <p>Scheduled Time: 180 minutes</p>
                        <p>Best Practice: 175 minutes</p>
                        <p>Unit Amount: 180,000</p>
                        <div class="machine-readiness not-ready">
                            <i class="fas fa-times-circle"></i>
                            <span>Machine Not Ready</span>
                        </div>
                    </div>
                    <div></div> <!-- Divider -->
                    <div>
                        <div class="progress-container">
                            <div class="progress-bar" style="width: 0%; background-color: #FFA500;"></div>
                        </div>
                        <p>Starts in: 2 hours 15 minutes</p>
                        <div class="status-indicator">
                            <span class="on-schedule" style="background-color: #FFA500;"></span>
                            <p>Scheduled</p>
                        </div>
                    </div>
                    <div></div> <!-- Divider -->
                    <div class="chart-container">
                        <canvas id="upcomingStopsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add new Shift Handover page -->
        <div id="handoverPage" class="page">
            <button class="back-button" onclick="navigateTo('main')">
                <i class="fas fa-arrow-left"></i>
                Back to Dashboard
            </button>
            
            <div class="handover-page">
                <div class="handover-header">
                    <h2>Shift Handover</h2>
                </div>
                
                <div class="handover-content active">
                    <div class="handover-summary">
                        <div class="summary-item">
                            <h3>Production Output</h3>
                            <p>Target: 250,000 units</p>
                            <p>Achieved: 245,000 units</p>
                        </div>
                        <div class="summary-item">
                            <h3>OEE Performance</h3>
                            <p>Average: 67.43%</p>
                            <p>Peak: 89.2%</p>
                        </div>
                        <div class="summary-item">
                            <h3>Stops</h3>
                            <p>Total: 45 minutes</p>
                            <p>Major: 2 incidents</p>
                        </div>
                    </div>
                    <div class="handover-notes">
                        <h3>Shift Notes</h3>
                        <p>• Material change completed at 14:30 - New batch running stable</p>
                        <p>• Minor adjustment needed on filler - Check pressure settings</p>
                        <p>• Maintenance crew: Changed cylinder in OCME</p>
                    </div>
                    <div class="machine-readiness-status">
                        <h3>Machine Readiness</h3>
                        <div class="machine-readiness ready">
                            <i class="fas fa-check-circle"></i>
                            <span>Kister: Ready</span>
                        </div>
                        <div class="machine-readiness not-ready">
                            <i class="fas fa-times-circle"></i>
                            <span>Jones: Not Ready</span>
                        </div>
                        <div class="machine-readiness ready">
                            <i class="fas fa-check-circle"></i>
                            <span>OCME: Ready</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div class="copilot-button" id="copilotBtn">
        <i class="fas fa-robot"></i>
    </div>

    <div class="chat-container" id="chatContainer">
        <div class="chat-header">
            <h3>Co-pilot Assistant</h3>
            <button onclick="toggleChat()">×</button>
        </div>
        <div class="chat-messages" id="chatMessages"></div>
        <div class="chat-input">
            <input type="text" id="chatInput" placeholder="Ask a question...">
            <button onclick="sendMessage()">Send</button>
        </div>
    </div>

    <!-- iPad Touch Controls -->
    <div id="debug-controls" style="position: fixed; bottom: 20px; left: 20px; z-index: 1001; display: flex; gap: 10px;">
        <button id="triggerErrorBtn" style="background-color: #2b3239; color: white; padding: 15px 20px; border-radius: 8px; border: none; font-weight: 600; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);">Trigger Error (Enter)</button>
        <button id="triggerPalletizerBtn" style="background-color: #2b3239; color: white; padding: 15px 20px; border-radius: 8px; border: none; font-weight: 600; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);">Trigger Palletizer (1)</button>
    </div>

    <script>
        // Initialize current batch stops chart
        const currentCtx = document.getElementById('currentStopsChart').getContext('2d');
        new Chart(currentCtx, {
            type: 'doughnut',
            data: {
                labels: ['CIP Issues', 'Filler crash', 'Breakdown OCME'],
                datasets: [{
                    data: [3, 2, 1],
                    backgroundColor: ['#FF8C00', '#1E90FF', '#F44336']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { color: '#ffffff' }
                    }
                }
            }
        });

        // Initialize upcoming batch stops chart
        const upcomingCtx = document.getElementById('upcomingStopsChart').getContext('2d');
        new Chart(upcomingCtx, {
            type: 'doughnut',
            data: {
                labels: ['Issues after changeover', 'Falling cans on conveyor', 'Pallet Collapse'],
                datasets: [{
                    data: [75, 15, 10],
                    backgroundColor: ['#F44336', '#1E90FF', '#FF8C00']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { color: '#ffffff' }
                    }
                }
            }
        });

        // Toggle handover content
        /*
        function toggleHandover() {
            const content = document.getElementById('handoverContent');
            const icon = document.querySelector('.toggle-icon');
            content.classList.toggle('active');
            icon.textContent = content.classList.contains('active') ? '−' : '+';
        }
        */

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                startErrorScenario();
            }
        });

        function updateMachineStatus(id, status) {
            const machine = document.getElementById(id);
            const icon = machine.querySelector('.status-icon');
            
            if (status === 'warning') {
                icon.classList.add('warning');
                icon.classList.remove('error');
            } else if (status === 'error') {
                icon.classList.add('error');
                icon.classList.remove('warning');
            } else {
                icon.classList.remove('warning', 'error');
            }
        }

        function startErrorScenario() {
            const overlay = document.createElement('div');
            overlay.className = 'overlay';
            document.body.appendChild(overlay);
            
            const depalletizer = document.getElementById('depalletizer');
            const filler = document.getElementById('filler');
            const arrow = document.getElementById('machineArrow');
            const warning = document.getElementById('machineWarning');

            const alertContainer = document.getElementById('alertContainer');
            alertContainer.style.zIndex = '1000';

            // Warning state
            setTimeout(() => {
                overlay.classList.add('active');
                depalletizer.classList.add('warning', 'focus');
                filler.classList.add('warning', 'focus');
                arrow.classList.add('warning');
                warning.classList.add('warning');
                showAlert('warning', 'Varning: Långsammare än normal hastighet på transportbanan mellan Depalletizer och Filler');
                
                // Update machine status icons
                updateMachineStatus('depalletizer', 'warning');
                updateMachineStatus('filler', 'warning');
                
                // Show copilot with warning suggestion
                const chatContainer = document.getElementById("chatContainer");
                const chatMessages = document.getElementById("chatMessages");
                chatContainer.style.display = "flex";
                
                const warningMessage = document.createElement("div");
                warningMessage.className = "system-message";
                warningMessage.innerHTML = `
                    <strong>Åtgärdsförslag:</strong><br>
                    1. Kontrollera transportbanan mellan Depalletizer och Filler<br>
                    2. Verifiera att inga flaskor har fastnat<br>
                    3. Kontrollera banans hastighet manuellt
                `;
                chatMessages.appendChild(warningMessage);
            }, 1000);

            // Error state
            setTimeout(() => {
                depalletizer.classList.remove('warning');
                filler.classList.remove('warning');
                depalletizer.classList.add('error');
                filler.classList.add('error');
                arrow.classList.remove('warning');
                arrow.classList.add('error');
                warning.classList.remove('warning');
                warning.classList.add('error');
                showAlert('error', 'FEL: Transportband stannat mellan Depalletizer och Filler - Kontakta underhåll');
                
                // Update machine status icons
                updateMachineStatus('depalletizer', 'error');
                updateMachineStatus('filler', 'error');
                
                // Show copilot with error suggestion
                const chatMessages = document.getElementById("chatMessages");
                
                const errorMessage = document.createElement("div");
                errorMessage.className = "system-message";
                errorMessage.innerHTML = `
                    <strong>Kritiskt fel - Åtgärdsförslag:</strong><br>
                    1. Frekvensomriktare F23 har stannat<br>
                    2. Kontakta underhåll omgående på: 555-123<br>
                    3. Rapportera felkod: ERR_F23_STOP
                `;
                chatMessages.appendChild(errorMessage);
            }, 10000);

            // Add click handler to remove overlay
            overlay.addEventListener('click', () => {
                overlay.classList.remove('active');
                document.querySelectorAll('.focus').forEach(el => el.classList.remove('focus'));
                alertContainer.style.zIndex = '';
            });
        }

        function showAlert(type, message) {
            const alertContainer = document.getElementById('alertContainer');
            const depalletizer = document.getElementById('depalletizer');
            
            // Remove all existing alerts with fade out
            const existingAlerts = alertContainer.children;
            Array.from(existingAlerts).forEach(alert => {
                alert.style.opacity = '0';
                setTimeout(() => alert.remove(), 300);
            });

            // Create new alert
            const alert = document.createElement('div');
            alert.className = type === 'warning' ? 'warning-message' : 'error-message';
            alert.textContent = message;
            alert.style.display = 'block';
            alert.classList.add('focus');
            
            // Position alert higher above machines (changed from -80 to -120)
            const rect = depalletizer.getBoundingClientRect();
            alertContainer.style.position = 'absolute';
            alertContainer.style.top = `${rect.top - 120}px`;
            alertContainer.style.left = `${rect.left}px`;
            alertContainer.style.width = '400px';
            
            // Add new alert after fade out of previous
            setTimeout(() => {
                alertContainer.appendChild(alert);
            }, 300);
        }

        let isDragging = false;
        let currentX;
        let currentY;
        let initialX;
        let initialY;
        let xOffset = 0;
        let yOffset = 0;

        const copilotBtn = document.getElementById("copilotBtn");

        copilotBtn.addEventListener("mousedown", dragStart);
        document.addEventListener("mousemove", drag);
        document.addEventListener("mouseup", dragEnd);

        function dragStart(e) {
            initialX = e.clientX - xOffset;
            initialY = e.clientY - yOffset;
            if (e.target === copilotBtn) {
                isDragging = true;
            }
        }

        function drag(e) {
            if (isDragging) {
                e.preventDefault();
                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;
                xOffset = currentX;
                yOffset = currentY;
                copilotBtn.style.transform = `translate(${currentX}px, ${currentY}px)`;
            }
        }

        function dragEnd() {
            isDragging = false;
        }

        function toggleChat() {
            const chatContainer = document.getElementById("chatContainer");
            chatContainer.style.display = chatContainer.style.display === "none" ? "flex" : "none";
        }

        copilotBtn.addEventListener("click", function(e) {
            if (!isDragging) {
                toggleChat();
            }
        });

        function sendMessage() {
            const input = document.getElementById("chatInput");
            const messages = document.getElementById("chatMessages");
            const userMessage = input.value.trim();
            
            if (userMessage !== "") {
                const messageDiv = document.createElement("div");
                messageDiv.textContent = userMessage;
                messages.appendChild(messageDiv);
                input.value = "";

                // Check for specific question
                if (userMessage.toLowerCase() === "vad gör en cop?") {
                    const responseDiv = document.createElement("div");
                    responseDiv.className = "system-message";
                    responseDiv.innerHTML = `
                        En COP (Clean-Out-of-Place) i tappen rengör delar av systemet som ligger utanför huvudflödet, som rör och ledningar som inte är direkt i kontakt med drycken. 
                        Det är en automatiserad process som spolar rent med vatten och rengöringsvätskor för att säkerställa hygien och funktion, utan att något behöver demonteras. 
                        COP startas enkelt från maskinens panel och sköter rengöringen själv.
                    `;
                    messages.appendChild(responseDiv);
                }
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const lowStockItems = document.querySelectorAll('.status-tag.warning');

            lowStockItems.forEach(item => {
                item.addEventListener('click', function() {
                    const materialName = this.closest('.material-card').querySelector('h3').textContent;
                    sendOrder(materialName);
                });
            });
        });

        function sendOrder(materialName) {
            // Simulate sending order
            setTimeout(() => {
                alert(`Beställning för ${materialName} har skickats till Materialaren.`);
            }, 500);
        }

        document.addEventListener('DOMContentLoaded', function() {
            const shrinkCard = document.getElementById('shrinkCard');

            shrinkCard.addEventListener('click', function() {
                if (!shrinkCard.classList.contains('ordered')) {
                    sendOrder('Shrink');
                    shrinkCard.classList.add('ordered');
                }
            });
        });

        function sendOrder(materialName) {
            // Simulate sending order
            setTimeout(() => {
                const notification = document.createElement('div');
                notification.className = 'system-message';
                notification.innerHTML = `Beställning för ${materialName} har skickats till Materialaren.`;
                document.getElementById('chatMessages').appendChild(notification);
            }, 500);
        }

        document.addEventListener('keydown', function(event) {
            if (event.key === '1') {
                startPalletizerErrorScenario();
            }
        });

        function startPalletizerErrorScenario() {
            const overlay = document.createElement('div');
            overlay.className = 'overlay';
            document.body.appendChild(overlay);

            const palletizer = document.getElementById('palletizer');
            const shrinkpacker = document.getElementById('shrinkpacker');
            const depalletizer = document.getElementById('depalletizer');
            const filler = document.getElementById('filler');

            const alertContainer = document.getElementById('alertContainer');
            alertContainer.style.zIndex = '1000';

            // Palletizer warning state
            setTimeout(() => {
                overlay.classList.add('active');
                palletizer.classList.add('warning', 'focus');
                showAlert('warning', 'Varning: Palletizer går långsammare - Endast 1 pallastare aktiv');
                updateMachineStatus('palletizer', 'warning');
                showCopilotRecommendation('Gå till Palletizer och kontrollera varför endast en pallastare är aktiv.');
            }, 1000);

            // Shrinkpacker warning state
            setTimeout(() => {
                shrinkpacker.classList.add('warning', 'focus');
                showAlert('warning', 'Varning: Shrinkpacker går långsammare');
                updateMachineStatus('shrinkpacker', 'warning');
                showCopilotRecommendation('Kontrollera Shrinkpacker för eventuella blockeringar eller felkoder.');
            }, 5000);

            // Palletizer error state
            setTimeout(() => {
                palletizer.classList.remove('warning');
                palletizer.classList.add('error');
                showAlert('error', 'FEL: Palletizer har stannat - Kontakta underhåll');
                updateMachineStatus('palletizer', 'error');
                showCopilotRecommendation('Felkod: ERR_PAL_STOP. Kontakta underhåll omgående.');
            }, 10000);

            // Shrinkpacker error state
            setTimeout(() => {
                shrinkpacker.classList.remove('warning');
                shrinkpacker.classList.add('error');
                showAlert('error', 'FEL: Shrinkpacker har stannat - Kontakta underhåll');
                updateMachineStatus('shrinkpacker', 'error');
                showCopilotRecommendation('Felkod: ERR_SHRINK_STOP. Kontakta underhåll omgående.');
            }, 15000);

            // Depalletizer and Filler warning state
            setTimeout(() => {
                depalletizer.classList.add('warning');
                filler.classList.add('warning');
                showAlert('warning', 'Varning: Depalletizer och Filler påverkas av problem längre ner i linjen');
                updateMachineStatus('depalletizer', 'warning');
                updateMachineStatus('filler', 'warning');
            }, 20000);

            // Depalletizer and Filler error state
            setTimeout(() => {
                depalletizer.classList.remove('warning');
                filler.classList.remove('warning');
                depalletizer.classList.add('error');
                filler.classList.add('error');
                showAlert('error', 'FEL: Depalletizer och Filler har stannat - Kontakta underhåll');
                updateMachineStatus('depalletizer', 'error');
                updateMachineStatus('filler', 'error');
            }, 25000);

            // Add click handler to remove overlay
            overlay.addEventListener('click', () => {
                overlay.classList.remove('active');
                document.querySelectorAll('.focus').forEach(el => el.classList.remove('focus'));
                alertContainer.style.zIndex = '';
            });
        }

        function showCopilotRecommendation(message) {
            const chatMessages = document.getElementById("chatMessages");
            const recommendation = document.createElement("div");
            recommendation.className = "system-message";
            recommendation.innerHTML = `
                ${message}
                <div class="feedback">
                    <button onclick="giveFeedback('up')">👍</button>
                    <button onclick="giveFeedback('down')">👎</button>
                </div>
            `;
            chatMessages.appendChild(recommendation);
        }

        function giveFeedback(feedback) {
            const feedbackMessage = document.createElement("div");
            feedbackMessage.className = "system-message";
            feedbackMessage.textContent = feedback === 'up' ? 'Tack för din feedback!' : 'Vi kommer att förbättra våra rekommendationer.';
            document.getElementById("chatMessages").appendChild(feedbackMessage);
        }

        // Theme toggle functionality
        document.getElementById('themeToggle').addEventListener('change', function() {
            if (this.checked) {
                // Dark theme
                document.body.classList.remove('light-theme');
            } else {
                // Light theme
                document.body.classList.add('light-theme');
            }
            
            // Update chart colors for better visibility
            const charts = Chart.instances;
            for (const chart of Object.values(charts)) {
                chart.options.plugins.legend.labels.color = this.checked ? '#ffffff' : '#333333';
                chart.update();
            }
        });

        // Add this to your <script> section
        function navigateTo(pageId) {
            const mainPage = document.getElementById('mainPage');
            const handoverPage = document.getElementById('handoverPage');
            
            if (pageId === 'main') {
                mainPage.classList.add('active');
                handoverPage.classList.remove('active');
            } else if (pageId === 'handover') {
                mainPage.classList.remove('active');
                handoverPage.classList.add('active');
            }
        }

        // Initialize navigation
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    const pageId = this.getAttribute('data-page');
                    navigateTo(pageId);
                });
            });
        });

        // Add event listeners for debug buttons
        document.getElementById('triggerErrorBtn').addEventListener('click', function() {
            startErrorScenario();
        });
        
        document.getElementById('triggerPalletizerBtn').addEventListener('click', function() {
            startPalletizerErrorScenario();
        });
        
        // Make buttons respect theme
        document.getElementById('themeToggle').addEventListener('change', function() {
            const buttons = document.querySelectorAll('#debug-controls button');
            if (this.checked) {
                // Dark theme
                buttons.forEach(btn => {
                    btn.style.backgroundColor = '#2b3239';
                    btn.style.color = 'white';
                });
            } else {
                // Light theme
                buttons.forEach(btn => {
                    btn.style.backgroundColor = '#f4f7fa';
                    btn.style.color = '#333333';
                    btn.style.border = '1px solid #e0e0e0';
                });
            }
        });
    </script>
</body>
</html>
